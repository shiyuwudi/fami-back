<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="/lib/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Welcome to Fami-Campaign-Page</title>
    <noscript>Please enable javascript first!</noscript>
</head>
<body>
<div id="app">
    <h1>Family Mart Coupon Page</h1>
    <hr/>
    <h3>Please scan the QR code below</h3>
    <div id="qrcode"></div>
    <p>{{ code }}</p>
    <p>{{ qs }}</p>
</div>
<script>
    var app =
        new Vue({
            el: '#app',
            data: {
                qr_code: '',
                code: '',
                resp: '',
                qs: '',
            },
            mounted() {
                this.getCode();
            },
            methods: {
                getCode: async function () {
                    this.resp = 'getCode';
                    const resp = await axios.get('/qr');
                    const {
                        code,
                        qr_code,
                    } = resp.data.data;
                    this.code = code;
                    this.qr_code = qr_code;
                    this.genQR();
                    this.qs = JSON.stringify(this.getQueryString());
                },
                genQR () {
                    new QRCode(document.getElementById("qrcode"), this.qr_code);
                },
                getQueryString() {
                    const url = location.search;
                    const theRequest = {};
                    if (url.indexOf("?") !== -1) {
                        let str = url.substr(1);
                        let strs = str.split("&");
                        for (let i = 0; i < strs.length; i++) {
                            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                        }
                    }
                    return theRequest;
                }
            },
        })
</script>
</body>
</html>
